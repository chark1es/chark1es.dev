name: Deploy Website

on:
    push:
        branches: [main]

jobs:
    deploy:
        name: Auto-Deploy
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v3

            # 1) Install Bun
            - name: Install Bun
              run: |
                  curl -fsSL https://bun.sh/install | bash
                  echo "BUN_INSTALL=$HOME/.bun" >> $GITHUB_ENV
                  echo "PATH=$HOME/.bun/bin:$PATH" >> $GITHUB_ENV

            # 2) Now bun is on PATH
            - name: Install coolctl
              run: bun add -g @coollabsio/coolctl

            - name: Deploy to Coolify
              env:
                  COOLIFY_API_URL: ${{ secrets.COOLIFY_API_URL }}
                  COOLIFY_TOKEN: ${{ secrets.COOLIFY_TOKEN }}
              run: |
                  coolctl deploy \
                    --app   "${{ secrets.COOLIFY_APP_NAME }}" \
                    --branch "${{ github.ref_name }}"
