name: Deploy Website

on:
    push:
        branches:
            - main

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v3

            - name: Install official Coolify CLI
              run: |
                  # install the Go-based CLI (supports the -d flag)
                  curl -fsSL https://raw.githubusercontent.com/coollabsio/coolify-cli/main/scripts/install.sh | bash
              # :contentReference[oaicite:0]{index=0}

            - name: Configure Coolify instance
              env:
                  COOLIFY_API_URL: ${{ secrets.COOLIFY_API_URL }} # e.g. https://api.coolify.io
                  COOLIFY_TOKEN: ${{ secrets.COOLIFY_TOKEN }}
              run: |
                  # (Re)move the default instance if it exists
                  coolify instances remove default || true

                  # Add your self-hosted instance with URL + token in one go:
                  coolify instances add -d default "${COOLIFY_API_URL:-https://api.coolify.io}" "${COOLIFY_TOKEN}"
                  # :contentReference[oaicite:1]{index=1}

                  # Make “default” the active instance
                  coolify instances set default default
                  # :contentReference[oaicite:2]{index=2}

            - name: Deploy to Coolify
              env:
                  APP_NAME: ${{ secrets.COOLIFY_APP_NAME }}
              run: |
                  # Push your main branch up to Coolify
                  coolify deploy "${APP_NAME}"
                  # :contentReference[oaicite:3]{index=3}
